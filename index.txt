<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì´ˆì—°ê¸ˆ í™•ì¸ ë° ì¶”ì–µì˜ ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ - ê°€ë…ì„± ê°œì„  */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            touch-action: manipulation;
            -webkit-font-smoothing: antialiased;
        }
        .hidden {
            display: none;
        }

        /* --- ê¸°ì´ˆì—°ê¸ˆ ê³„ì‚°ê¸° ìŠ¤íƒ€ì¼ (ê°€ë…ì„± ê°•í™”) --- */
        #pension-container {
            --primary-color: #1e40af;
            --secondary-color: #3b82f6;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --radius: 1.2rem;
            --text-color: #1e293b;
            font-size: 20px; /* ê¸°ë³¸ í°íŠ¸ í¬ê¸° ì¦ê°€ */
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            padding: 1rem 0;
        }
        #pension-container header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: #fff;
            padding: 1.5rem 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #pension-container header h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }
        #pension-container main {
            max-width: 720px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }
        #pension-container fieldset {
            border: none;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f1f5f9;
            border-radius: 0.8rem;
        }
        #pension-container legend {
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #pension-container label {
            display: block;
            margin: 1rem 0 0.5rem;
            font-weight: 500;
            color: #475569;
        }
        #pension-container input,
        #pension-container select {
            width: 100%;
            padding: 0.9rem 1.2rem;
            font-size: 1.1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.6rem;
            transition: all 0.3s;
            background: white;
        }
        #pension-container input:focus,
        #pension-container select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        #pension-container input[type="radio"] {
            width: auto;
            margin-right: 0.5rem;
            transform: scale(1.3);
        }
        #pension-container .radio-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.8rem 0;
            padding: 0.8rem;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        #pension-container .radio-group label:hover {
            background: #f8fafc;
        }
        #pension-container .radio-group small {
            font-size: 0.95rem;
            color: #64748b;
            margin-left: 0.5rem;
        }
        #pension-container button[type="submit"] {
            font-size: 1.2rem;
            padding: 1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        #pension-container #result {
            margin-top: 2rem;
            font-size: 1.15rem;
            font-weight: 600;
            white-space: pre-line;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 0.8rem;
            border-left: 4px solid var(--secondary-color);
            line-height: 1.8;
        }
        #pension-container .result-success {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
            border-left-color: #22c55e !important;
        }
        #pension-container .result-fail {
            background: linear-gradient(135deg, #fef2f2, #fee2e2) !important;
            border-left-color: #ef4444 !important;
        }
        #pension-container .apply,
        #pension-container .benefits {
            margin-top: 1.5rem;
            border-top: 2px dashed #cbd5e1;
            padding-top: 1.5rem;
        }
        #pension-container .apply h3,
        #pension-container .benefits h3 {
            margin: 0 0 1rem;
            font-size: 1.25rem;
            color: var(--primary-color);
            font-weight: 600;
        }
        #pension-container .apply ul,
        #pension-container .benefits ul {
            padding-left: 1.5rem;
            margin: 0.5rem 0;
        }
        #pension-container .apply li,
        #pension-container .benefits li {
            margin-bottom: 0.6rem;
            font-size: 1rem;
            line-height: 1.6;
        }
        #pension-container .disclaimer {
            margin-top: 2rem;
            padding: 1rem;
            font-size: 0.95rem;
            color: #64748b;
            background: #fef3c7;
            border-radius: 0.6rem;
            border: 1px solid #fbbf24;
        }
        
        /* --- ì˜¤ëª© ê²Œì„ ìŠ¤íƒ€ì¼ --- */
        #game-app-container {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            min-height: 100vh;
        }
        .board-container {
            position: relative;
            width: 95vw;
            max-width: 640px;
            margin: auto;
            aspect-ratio: 1 / 1;
        }
        #game-board {
            background-color: #e3c16f;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        .status-box {
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        
        /* ê³µìš© ë²„íŠ¼ (ê°€ë…ì„± ê°œì„ ) */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: #475569;
            color: white;
            padding: 12px 20px;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
            transition: all 0.3s;
        }
        .back-button:hover {
            background-color: #334155;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        /* ë©”ì¸ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
        .main-button {
            font-size: 1.3rem !important;
            padding: 1.5rem 2rem !important;
            border-radius: 1rem !important;
            transition: all 0.3s !important;
            font-weight: 600 !important;
        }
        .main-button:hover {
            transform: translateY(-3px) scale(1.02) !important;
            box-shadow: 0 12px 24px rgba(0,0,0,0.15) !important;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ê°œì„  */
        @media (max-width: 640px) {
            #pension-container {
                font-size: 18px;
            }
            #pension-container main {
                padding: 1.5rem;
                margin: 1rem;
            }
            #pension-container fieldset {
                padding: 1rem;
            }
            .main-button {
                font-size: 1.1rem !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- ë©”ì¸ ì„ íƒ í™”ë©´ -->
    <div id="main-selection" class="flex flex-col items-center justify-center min-h-screen p-4">
        <h1 class="text-4xl md:text-6xl font-bold text-gray-800 mb-16 text-center">ë¬´ì—‡ì„ í•˜ì‹œê² ì–´ìš”?</h1>
        <div class="w-full max-w-lg mx-auto space-y-8">
            <button id="select-pension" class="main-button w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-xl">
                ğŸ’° 2025ë…„ ê¸°ì´ˆì—°ê¸ˆ ìê²© í™•ì¸
            </button>
            <button id="select-game" class="main-button w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-xl">
                ğŸ® ì¶”ì–µì˜ í”Œë˜ì‹œ ê²Œì„ (ì˜¤ëª©)
            </button>
        </div>
    </div>

    <!-- ê¸°ì´ˆì—°ê¸ˆ ê³„ì‚°ê¸° ì»¨í…Œì´ë„ˆ -->
    <div id="pension-container" class="hidden">
        <button class="back-button" onclick="showMainSelection()">â€¹ ë’¤ë¡œ</button>
        <header>
            <h1>2025 ê¸°ì´ˆì—°ê¸ˆ ìê²© ë¹ ë¥¸ í™•ì¸</h1>
        </header>
        <main>
            <form id="pensionForm">
                <fieldset>
                    <legend>ğŸ“‹ 1. ê¸°ë³¸ ì •ë³´</legend>
                    <label for="birthYear">ì¶œìƒ ì—°ë„</label>
                    <select id="birthYear" required></select>
                    <label for="birthMonth">ì¶œìƒ ì›”</label>
                    <select id="birthMonth" required></select>
                    <label for="household">ê°€êµ¬ ìœ í˜•</label>
                    <select id="household" required>
                        <option value="single">ë‹¨ë…ê°€êµ¬ (1ì¸)</option>
                        <option value="couple">ë¶€ë¶€ê°€êµ¬ (2ì¸)</option>
                    </select>
                    <label>ê±°ì£¼ ì§€ì—­</label>
                    <div class="radio-group" id="areaOptions">
                        <label><input type="radio" name="area" value="big" required /> ëŒ€ë„ì‹œ <small>(íŠ¹ë³„ì‹œÂ·ê´‘ì—­ì‹œ)</small></label>
                        <label><input type="radio" name="area" value="mid" /> ì¤‘ì†Œë„ì‹œ <small>(ì¼ë°˜ ì‹œ ì§€ì—­)</small></label>
                        <label><input type="radio" name="area" value="rural" /> ë†ì–´ì´Œ <small>(êµ° ì§€ì—­)</small></label>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>ğŸ’µ 2. ì›” ì†Œë“</legend>
                    <label for="income">ë³¸ì¸ ì›”ì†Œë“ (ê·¼ë¡œÂ·ì‚¬ì—…Â·ì—°ê¸ˆ ë“±)</label>
                    <input type="text" id="income" placeholder="ì˜ˆ: 120ë§Œì› ë˜ëŠ” 1,200,000ì›" required />
                    <label for="spouseIncome">ë°°ìš°ì ì›”ì†Œë“ (ë¶€ë¶€ê°€êµ¬ë§Œ)</label>
                    <input type="text" id="spouseIncome" placeholder="ì˜ˆ: 80ë§Œì› ë˜ëŠ” 800,000ì›" />
                </fieldset>
                <fieldset>
                    <legend>ğŸ  3. ë³´ìœ  ì¬ì‚°</legend>
                    <label for="homeValue">ì£¼íƒ/ë¶€ë™ì‚° ì‹œê°€ì´ì•¡</label>
                    <input type="text" id="homeValue" placeholder="ì˜ˆ: 2ì–µì› ë˜ëŠ” 200,000,000ì›" />
                    <label for="deposit">ì „Â·ì›”ì„¸ ë³´ì¦ê¸ˆ</label>
                    <input type="text" id="deposit" placeholder="ì˜ˆ: 5000ë§Œì›" />
                    <label for="savings">ì˜ˆê¸ˆÂ·ì ê¸ˆ ì´ì•¡</label>
                    <input type="text" id="savings" placeholder="ì˜ˆ: 3000ë§Œì›" />
                    <label for="stocks">ì£¼ì‹Â·í€ë“œÂ·ì±„ê¶Œ ë“±</label>
                    <input type="text" id="stocks" placeholder="ì˜ˆ: 1000ë§Œì›" />
                    <label for="car">ìë™ì°¨ ê°€ì•¡</label>
                    <input type="text" id="car" placeholder="ì˜ˆ: 2000ë§Œì›" />
                    <label for="debt">ë¶€ì±„ (ëŒ€ì¶œê¸ˆ ë“±)</label>
                    <input type="text" id="debt" placeholder="ì˜ˆ: 5000ë§Œì›" />
                </fieldset>
                <button type="submit" class="w-full py-4 text-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 shadow-lg transition-all">
                    ìê²© í™•ì¸í•˜ê¸°
                </button>
            </form>
            <div id="result"></div>
            <div id="applyInfo" class="apply" style="display: none;"></div>
            <div id="benefitBox" class="benefits" style="display: none;"></div>
            <p class="disclaimer">
                âš ï¸ <strong>ì£¼ì˜ì‚¬í•­:</strong> ë³¸ ê³„ì‚° ê²°ê³¼ëŠ” 2025ë…„ ê¸°ì¤€ ê¸°ì´ˆì—°ê¸ˆ ì„ ì •ê¸°ì¤€ì„ ê°„ëµíˆ ì ìš©í•œ ì˜ˆìƒ ê²°ê³¼ì…ë‹ˆë‹¤.
                ì‹¤ì œ ìˆ˜ê¸‰ ì—¬ë¶€ì™€ ê¸ˆì•¡ì€ êµ­ë¯¼ì—°ê¸ˆê³µë‹¨ì˜ ì •ë°€ ì‹¬ì‚¬ë¥¼ í†µí•´ ê²°ì •ë˜ë¯€ë¡œ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </main>
    </div>

    <!-- ì˜¤ëª© ê²Œì„ ì»¨í…Œì´ë„ˆ -->
    <div id="game-app-container" class="hidden">
        <button class="back-button" onclick="showMainSelection()">â€¹ ë’¤ë¡œ</button>
        <div id="game-mode-selection" class="w-full max-w-md mx-auto text-center flex flex-col justify-center min-h-screen">
            <h1 class="text-5xl md:text-6xl font-bold text-gray-800 mb-12">ğŸ¯ ì˜¤ëª© ê²Œì„</h1>
            <div class="space-y-6">
                <button id="ai-mode-btn" class="main-button w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-xl">
                    ğŸ¤– AI ëŒ€ì „
                </button>
                <button id="pvp-mode-btn" class="main-button w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-xl">
                    ğŸ‘¥ 1 vs 1 ëŒ€ì „
                </button>
            </div>
        </div>
        <div id="game-container" class="w-full max-w-2xl mx-auto hidden flex flex-col justify-center min-h-screen p-4">
            <h1 id="game-title" class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-6"></h1>
            <div id="status-box" class="status-box text-center bg-white p-4 rounded-xl shadow-lg mb-6">
                <p id="status-text" class="text-xl font-semibold text-gray-700">ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            </div>
            <div class="board-container">
                <canvas id="game-board"></canvas>
            </div>
            <div class="mt-6 grid grid-cols-2 gap-4">
                <button id="new-game-btn" class="bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all text-lg">
                    ğŸ”„ ìƒˆ ê²Œì„
                </button>
                <button id="game-back-to-menu-btn" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all text-lg">
                    ğŸ“‹ ëª¨ë“œ ì„ íƒ
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- í˜ì´ì§€ ì „í™˜ ë¡œì§ ---
        const mainSelectionDiv = document.getElementById('main-selection');
        const pensionContainer = document.getElementById('pension-container');
        const gameAppContainer = document.getElementById('game-app-container');

        document.getElementById('select-pension').addEventListener('click', () => {
            mainSelectionDiv.classList.add('hidden');
            pensionContainer.classList.remove('hidden');
        });

        document.getElementById('select-game').addEventListener('click', () => {
            mainSelectionDiv.classList.add('hidden');
            gameAppContainer.classList.remove('hidden');
            gameApp.resizeCanvas();
        });

        function showMainSelection() {
            pensionContainer.classList.add('hidden');
            gameAppContainer.classList.add('hidden');
            mainSelectionDiv.classList.remove('hidden');
        }

        // --- ê¸°ì´ˆì—°ê¸ˆ ê³„ì‚°ê¸° ìŠ¤í¬ë¦½íŠ¸ (ìˆ˜ì •ëœ ê³„ì‚° ë¡œì§) ---
        const pensionApp = (() => {
            const CONFIG = {
                year: 2025,
                // 2025ë…„ ê¸°ì´ˆì—°ê¸ˆ ì„ ì •ê¸°ì¤€ì•¡ (ì†Œë“ì¸ì •ì•¡ ê¸°ì¤€)
                incomeThreshold: { 
                    single: 2280000,  // ë‹¨ë…ê°€êµ¬ 228ë§Œì›
                    couple: 3648000   // ë¶€ë¶€ê°€êµ¬ 364.8ë§Œì›
                },
                // ì§€ì—­ë³„ ê¸°ë³¸ì¬ì‚° ê³µì œì•¡
                basicAsset: { 
                    big: 135000000,   // ëŒ€ë„ì‹œ 1.35ì–µ
                    mid: 85000000,    // ì¤‘ì†Œë„ì‹œ 8,500ë§Œì›
                    rural: 72500000   // ë†ì–´ì´Œ 7,250ë§Œì›
                },
                // ê¸ˆìœµì¬ì‚° ê³µì œì•¡
                financialDeduction: {
                    single: 20000000,  // ë‹¨ë… 2,000ë§Œì›
                    couple: 40000000   // ë¶€ë¶€ 4,000ë§Œì›
                },
                // 2025ë…„ ê¸°ì´ˆì—°ê¸ˆ ìµœëŒ€ ì§€ê¸‰ì•¡
                benefit: { 
                    single: 334810,    // ë‹¨ë…ê°€êµ¬ ìµœëŒ€
                    couplePer: 267848  // ë¶€ë¶€ 1ì¸ë‹¹ ìµœëŒ€ (20% ê°ì•¡)
                },
                // ì¬ì‚°ì˜ ì†Œë“í™˜ì‚°ìœ¨
                assetConversionRate: 0.04 / 12,  // ì—° 4% Ã· 12ê°œì›”
            };

            const SENIOR_BENEFITS = [
                { 
                    title: "ğŸ“ ì „êµ­ ê³µí†µ í˜œíƒ", 
                    list: [
                        "ì˜ë£Œë¹„ ë³¸ì¸ë¶€ë‹´ê¸ˆ ê°ë©´ (30~60%)",
                        "êµ­ë¯¼ê±´ê°•ê²€ì§„ 2ë…„ë§ˆë‹¤ ë¬´ë£Œ",
                        "KTXÂ·SRT 30% í• ì¸ (ì£¼ì¤‘)",
                        "êµ­ë¦½ê³µì›Â·ê³ ê¶Â·ë°•ë¬¼ê´€ ë¬´ë£Œ ì…ì¥",
                        "ë¬¸í™”ëˆ„ë¦¬ì¹´ë“œ ì—° 13ë§Œì› ì§€ì›",
                        "ì¹˜ë§¤ ì¡°ê¸°ê²€ì§„ ë¬´ë£Œ"
                    ] 
                },
                { 
                    title: "ğŸ™ï¸ ì„œìš¸íŠ¹ë³„ì‹œ", 
                    list: [
                        "ì–´ë¥´ì‹  êµí†µì¹´ë“œë¡œ ì§€í•˜ì² Â·ë²„ìŠ¤ ë¬´ë£Œ",
                        "ì„œìš¸ì‹œë¦½ ë¬¸í™”ì‹œì„¤ 50% í• ì¸",
                        "ê²½ë¡œë‹¹ ë¬´ë£Œ ì´ìš©"
                    ] 
                },
                { 
                    title: "ğŸŒ† ê²½ê¸°ë„", 
                    list: [
                        "ê²½ê¸°ë„ ì–´ë¥´ì‹  êµí†µì¹´ë“œ ì§€ì›",
                        "ë„ë¦½ ë¬¸í™”Â·ì²´ìœ¡ì‹œì„¤ í• ì¸",
                        "ë…ê° ì˜ˆë°©ì ‘ì¢… ë¬´ë£Œ"
                    ] 
                },
            ];

            function populateBirthSelects() {
                const yearSel = document.getElementById("birthYear");
                const monthSel = document.getElementById("birthMonth");
                if (!yearSel || yearSel.options.length > 1) return;
                
                const currentYear = new Date().getFullYear();
                for (let y = currentYear - 65; y >= currentYear - 100; y--) {
                    const opt = document.createElement("option");
                    opt.value = y;
                    opt.textContent = `${y}ë…„`;
                    yearSel.appendChild(opt);
                }
                for (let m = 1; m <= 12; m++) {
                    const opt = document.createElement("option");
                    opt.value = m;
                    opt.textContent = `${m}ì›”`;
                    monthSel.appendChild(opt);
                }
            }

            // ê°€êµ¬ ìœ í˜• ë³€ê²½ ì‹œ ë°°ìš°ì ì†Œë“ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
            function toggleSpouseIncome() {
                const household = document.getElementById("household").value;
                const spouseIncomeField = document.getElementById("spouseIncome");
                const spouseLabel = spouseIncomeField.previousElementSibling;
                
                if (household === "couple") {
                    spouseIncomeField.style.display = "block";
                    spouseLabel.style.display = "block";
                } else {
                    spouseIncomeField.style.display = "none";
                    spouseLabel.style.display = "none";
                    spouseIncomeField.value = "";
                }
            }

            function numFromText(str) {
                if (!str) return 0;
                str = str.replace(/\s|ì›|,/g, "");
                let total = 0;
                const eok = str.match(/([0-9.]+)ì–µ/);
                if (eok) { 
                    total += parseFloat(eok[1]) * 100000000; 
                    str = str.replace(eok[0], ""); 
                }
                const man = str.match(/([0-9.]+)ë§Œ/);
                if (man) { 
                    total += parseFloat(man[1]) * 10000; 
                    str = str.replace(man[0], ""); 
                }
                const nums = str.match(/[0-9]+/g);
                if (nums) { 
                    total += parseInt(nums.join(""), 10); 
                }
                return isNaN(total) ? 0 : total;
            }

            function formatKRW(n) { 
                return n.toLocaleString("ko-KR") + "ì›"; 
            }
            
            function calcAge(byear, bmonth) {
                const today = new Date();
                let age = today.getFullYear() - byear;
                if (bmonth > today.getMonth() + 1) age--;
                return age;
            }

            // ì†Œë“ì¸ì •ì•¡ ê³„ì‚° (ìˆ˜ì •ëœ ë¡œì§)
            function calculateIncomeRecognition(income, spouseIncome, assets, debt, household, area) {
                // 1. ì›” ì†Œë“ ê³„ì‚°
                const totalMonthlyIncome = income + spouseIncome;
                
                // 2. ì¼ë°˜ì¬ì‚° ê³„ì‚° (ë¶€ë™ì‚° + ì „ì›”ì„¸ë³´ì¦ê¸ˆ + ìë™ì°¨ - ë¶€ì±„)
                const generalAssets = assets.home + assets.deposit + assets.car - debt;
                
                // 3. ê¸ˆìœµì¬ì‚° ê³„ì‚°
                const financialAssets = assets.savings + assets.stocks;
                
                // 4. ê¸°ë³¸ì¬ì‚° ê³µì œ
                const basicDeduction = CONFIG.basicAsset[area];
                const netGeneralAssets = Math.max(0, generalAssets - basicDeduction);
                
                // 5. ê¸ˆìœµì¬ì‚° ê³µì œ
                const financialDeduction = CONFIG.financialDeduction[household];
                const netFinancialAssets = Math.max(0, financialAssets - financialDeduction);
                
                // 6. ì¬ì‚°ì˜ ì†Œë“í™˜ì‚°ì•¡ ê³„ì‚°
                const assetIncome = (netGeneralAssets + netFinancialAssets) * CONFIG.assetConversionRate;
                
                // 7. ì†Œë“ì¸ì •ì•¡ = ì›”ì†Œë“ + ì¬ì‚°ì˜ ì†Œë“í™˜ì‚°ì•¡
                const incomeRecognition = totalMonthlyIncome + assetIncome;
                
                return {
                    monthlyIncome: totalMonthlyIncome,
                    assetIncome: assetIncome,
                    total: incomeRecognition,
                    netAssets: netGeneralAssets + netFinancialAssets
                };
            }

            function buildApplyInfo() { 
                return `
<h3>ğŸ“ ì‹ ì²­ ë°©ë²•</h3>
<ul>
    <li><strong>ë°©ë¬¸ ì‹ ì²­:</strong> ì£¼ì†Œì§€ ìÂ·ë©´Â·ë™ ì£¼ë¯¼ì„¼í„°</li>
    <li><strong>ì˜¨ë¼ì¸ ì‹ ì²­:</strong> ë³µì§€ë¡œ(www.bokjiro.go.kr)</li>
    <li><strong>ëŒ€ë¦¬ ì‹ ì²­:</strong> ë°°ìš°ì, ìë…€, í˜•ì œìë§¤ ë“± ê°€ëŠ¥</li>
</ul>
<h4 style="margin-top: 1rem;">ğŸ“‹ í•„ìš” ì„œë¥˜</h4>
<ul>
    <li>ì‹ ë¶„ì¦</li>
    <li>í†µì¥ ì‚¬ë³¸</li>
    <li>ë°°ìš°ì ì‹ ë¶„ì¦ (ë¶€ë¶€ê°€êµ¬)</li>
    <li>ê¸°íƒ€ ì†Œë“Â·ì¬ì‚° ì¦ë¹™ì„œë¥˜ (í•„ìš”ì‹œ)</li>
</ul>`; 
            }
            
            function buildBenefitsHtml() {
                let html = "<h3>ğŸ 65ì„¸ ì´ìƒ ì£¼ìš” í˜œíƒ</h3>";
                SENIOR_BENEFITS.forEach((cat) => {
                    html += `<div style="margin-top: 1rem;"><strong>${cat.title}</strong><ul>`;
                    cat.list.forEach((li) => (html += `<li>${li}</li>`));
                    html += "</ul></div>";
                });
                return html;
            }

            function init() {
                populateBirthSelects();
                
                // ê°€êµ¬ ìœ í˜• ë³€ê²½ ì´ë²¤íŠ¸
                document.getElementById("household").addEventListener("change", toggleSpouseIncome);
                toggleSpouseIncome(); // ì´ˆê¸° ì„¤ì •
                
                document.getElementById("pensionForm").addEventListener("submit", function (e) {
                    e.preventDefault();
                    
                    const byear = parseInt(document.getElementById("birthYear").value, 10);
                    const bmonth = parseInt(document.getElementById("birthMonth").value, 10);
                    const household = document.getElementById("household").value;
                    const areaRadio = document.querySelector("input[name='area']:checked");
                    
                    if (!areaRadio) {
                        alert("ê±°ì£¼ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    
                    const area = areaRadio.value;
                    const income = numFromText(document.getElementById("income").value);
                    const spouseIncome = numFromText(document.getElementById("spouseIncome").value);
                    const debt = numFromText(document.getElementById("debt").value);
                    
                    const assets = {
                        home: numFromText(document.getElementById("homeValue").value),
                        deposit: numFromText(document.getElementById("deposit").value),
                        savings: numFromText(document.getElementById("savings").value),
                        stocks: numFromText(document.getElementById("stocks").value),
                        car: numFromText(document.getElementById("car").value)
                    };
                    
                    const age = calcAge(byear, bmonth);
                    const incomeCalc = calculateIncomeRecognition(income, spouseIncome, assets, debt, household, area);
                    const incomeLimit = CONFIG.incomeThreshold[household];
                    const incomeEligible = incomeCalc.total <= incomeLimit;
                    const ageEligible = age >= 65;
                    
                    let msg = "";
                    const resultDiv = document.getElementById("result");
                    
                    if (ageEligible && incomeEligible) {
                        const benefitAmt = household === "single" ? CONFIG.benefit.single : CONFIG.benefit.couplePer;
                        msg += `âœ… <strong>ê¸°ì´ˆì—°ê¸ˆ ìˆ˜ê¸‰ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤!</strong>\n\n`;
                        msg += `ğŸ’° ì˜ˆìƒ ì›” ì§€ê¸‰ì•¡: <strong>${formatKRW(benefitAmt)}</strong>\n`;
                        if (household === "couple") {
                            msg += `   (ë¶€ë¶€ í•©ê³„: ${formatKRW(benefitAmt * 2)})\n`;
                        }
                        msg += `\nğŸ“Š ì†Œë“ì¸ì •ì•¡ ë¶„ì„:\n`;
                        msg += `â€¢ ì›” ì†Œë“: ${formatKRW(incomeCalc.monthlyIncome)}\n`;
                        msg += `â€¢ ì¬ì‚°ì˜ ì†Œë“í™˜ì‚°ì•¡: ${formatKRW(Math.round(incomeCalc.assetIncome))}\n`;
                        msg += `â€¢ ì†Œë“ì¸ì •ì•¡: ${formatKRW(Math.round(incomeCalc.total))}\n`;
                        msg += `â€¢ ì„ ì •ê¸°ì¤€ì•¡: ${formatKRW(incomeLimit)}`;
                        
                        resultDiv.className = "result-success";
                    } else {
                        msg += `âŒ <strong>í˜„ì¬ ê¸°ì¤€ìœ¼ë¡œëŠ” ìˆ˜ê¸‰ ìš”ê±´ì„ ì¶©ì¡±í•˜ì§€ ëª»í•©ë‹ˆë‹¤.</strong>\n\n`;
                        msg += `ğŸ“Š ë¯¸ì¶©ì¡± ì‚¬ìœ :\n`;
                        
                        if (!ageEligible) {
                            msg += `â€¢ ì—°ë ¹ ì¡°ê±´: ë§Œ 65ì„¸ ì´ìƒ (í˜„ì¬ ${age}ì„¸, ${65 - age}ë…„ í›„ ì‹ ì²­ ê°€ëŠ¥)\n`;
                        }
                        if (!incomeEligible) {
                            msg += `â€¢ ì†Œë“ì¸ì •ì•¡ ì´ˆê³¼:\n`;
                            msg += `  - ê·€í•˜ì˜ ì†Œë“ì¸ì •ì•¡: ${formatKRW(Math.round(incomeCalc.total))}\n`;
                            msg += `  - ì„ ì •ê¸°ì¤€ì•¡: ${formatKRW(incomeLimit)}\n`;
                            msg += `  - ì´ˆê³¼ê¸ˆì•¡: ${formatKRW(Math.round(incomeCalc.total - incomeLimit))}\n`;
                        }
                        
                        if (!ageEligible) {
                            msg += `\nğŸ’¡ <strong>Tip:</strong> ë§Œ 65ì„¸ê°€ ë˜ëŠ” ìƒì¼ì´ ì†í•œ ë‹¬ì˜ 1ê°œì›” ì „ë¶€í„° ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
                        } else {
                            msg += `\nğŸ’¡ <strong>Tip:</strong> ì¬ì‚° ì²˜ë¶„ì´ë‚˜ ì†Œë“ ê°ì†Œ ì‹œ ì¬ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
                        }
                        
                        resultDiv.className = "result-fail";
                    }
                    
                    resultDiv.innerHTML = msg.replace(/\n/g, '<br>');
                    resultDiv.style.display = "block";
                    
                    const applyDiv = document.getElementById("applyInfo");
                    applyDiv.style.display = "block";
                    applyDiv.innerHTML = buildApplyInfo();
                    
                    const benefitBox = document.getElementById("benefitBox");
                    benefitBox.innerHTML = buildBenefitsHtml();
                    benefitBox.style.display = "block";
                    
                    // ê²°ê³¼ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
            }
            return { init };
        })();
        
        // --- ì˜¤ëª© ê²Œì„ ìŠ¤í¬ë¦½íŠ¸ ---
        const gameApp = (() => {
            const gameModeSelectionDiv = document.getElementById('game-mode-selection');
            const gameContainerDiv = document.getElementById('game-container');
            const aiModeBtn = document.getElementById('ai-mode-btn');
            const pvpModeBtn = document.getElementById('pvp-mode-btn');
            const gameTitle = document.getElementById('game-title');
            const canvas = document.getElementById('game-board');
            const ctx = canvas.getContext('2d');
            const statusText = document.getElementById('status-text');
            const newGameBtn = document.getElementById('new-game-btn');
            const gameBackToMenuBtn = document.getElementById('game-back-to-menu-btn');
            const statusBox = document.getElementById('status-box');
            const BOARD_SIZE = 15;
            let cellSize, margin;
            let board = [], currentPlayer, gameOver, isAIThinking, lastMove, gameMode = null;
            const BASE_DEPTH = 2, CRITICAL_DEPTH = 4;

            function startGame(mode) {
                gameMode = mode;
                gameModeSelectionDiv.classList.add('hidden');
                gameContainerDiv.classList.remove('hidden');
                gameTitle.textContent = mode === 'ai' ? 'ğŸ¤– AI ëŒ€ê²°' : 'ğŸ‘¥ 1 vs 1 ëŒ€ê²°';
                resizeCanvas();
                initGame();
            }

            function backToGameMenu() {
                gameContainerDiv.classList.add('hidden');
                gameModeSelectionDiv.classList.remove('hidden');
                gameMode = null;
            }

            function initGame() {
                board = Array(BOARD_SIZE).fill(0).map(() => Array(BOARD_SIZE).fill(0));
                currentPlayer = 1;
                gameOver = false;
                isAIThinking = false;
                lastMove = null;
                updateStatus('âš« í‘ëŒ ì°¨ë¡€ì…ë‹ˆë‹¤.');
                drawBoard();
            }

            function resizeCanvas() {
                const container = canvas.parentElement;
                const size = Math.min(container.clientWidth, container.clientHeight);
                canvas.width = size;
                canvas.height = size;
                cellSize = canvas.width / (BOARD_SIZE + 1);
                margin = cellSize;
                if (gameMode) drawBoard();
            }

            function drawBoard() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ë³´ë“œ ë°°ê²½ ê·¸ë¼ë°ì´ì…˜
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#f4d58d');
                gradient.addColorStop(1, '#d4a574');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ê²©ìì„ 
                ctx.strokeStyle = '#5b4b3a';
                ctx.lineWidth = 1.5;
                for (let i = 0; i < BOARD_SIZE; i++) {
                    ctx.beginPath();
                    ctx.moveTo(margin, margin + i * cellSize);
                    ctx.lineTo(canvas.width - margin, margin + i * cellSize);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(margin + i * cellSize, margin);
                    ctx.lineTo(margin + i * cellSize, canvas.height - margin);
                    ctx.stroke();
                }
                
                // í™”ì 
                const starPoints = [{x: 3, y: 3}, {x: 11, y: 3}, {x: 3, y: 11}, {x: 11, y: 11}, {x: 7, y: 7}];
                ctx.fillStyle = '#5b4b3a';
                starPoints.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(margin + p.x * cellSize, margin + p.y * cellSize, cellSize / 6, 0, 2 * Math.PI);
                    ctx.fill();
                });
                
                // ëŒ ê·¸ë¦¬ê¸°
                for (let y = 0; y < BOARD_SIZE; y++) {
                    for (let x = 0; x < BOARD_SIZE; x++) {
                        if (board[y][x] !== 0) drawStone(x, y, board[y][x]);
                    }
                }
                
                // ë§ˆì§€ë§‰ ìˆ˜ í‘œì‹œ
                if (lastMove) {
                    ctx.strokeStyle = '#ff4444';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(margin + lastMove.x * cellSize, margin + lastMove.y * cellSize, cellSize * 0.25, 0, 2 * Math.PI);
                    ctx.stroke();
                }
            }

            function drawStone(x, y, player) {
                const stoneX = margin + x * cellSize;
                const stoneY = margin + y * cellSize;
                const radius = cellSize / 2 * 0.85;
                
                // ê·¸ë¦¼ì
                ctx.beginPath();
                ctx.arc(stoneX + 2, stoneY + 2, radius, 0, 2 * Math.PI);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fill();
                
                // ëŒ ê·¸ë¼ë°ì´ì…˜
                const gradient = ctx.createRadialGradient(
                    stoneX - radius * 0.3, 
                    stoneY - radius * 0.3, 
                    radius * 0.1, 
                    stoneX, 
                    stoneY, 
                    radius
                );
                
                if (player === 1) {
                    gradient.addColorStop(0, '#555');
                    gradient.addColorStop(0.5, '#222');
                    gradient.addColorStop(1, '#000');
                } else {
                    gradient.addColorStop(0, '#ffffff');
                    gradient.addColorStop(0.5, '#f0f0f0');
                    gradient.addColorStop(1, '#d0d0d0');
                }
                
                ctx.beginPath();
                ctx.arc(stoneX, stoneY, radius, 0, 2 * Math.PI);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // í…Œë‘ë¦¬
                ctx.strokeStyle = player === 1 ? '#000' : '#999';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            function handleCanvasClick(event) {
                if (gameOver || isAIThinking || (gameMode === 'ai' && currentPlayer === 2)) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                const gridX = Math.round((x - margin) / cellSize);
                const gridY = Math.round((y - margin) / cellSize);
                
                if (gridX >= 0 && gridX < BOARD_SIZE && gridY >= 0 && gridY < BOARD_SIZE && board[gridY][gridX] === 0) {
                    placeStone(gridX, gridY, currentPlayer);
                }
            }

            function placeStone(x, y, player) {
                board[y][x] = player;
                lastMove = {x, y};
                drawBoard();
                
                if (checkWin(x, y, player)) {
                    gameOver = true;
                    let winner = (gameMode === 'ai') 
                        ? (player === 1 ? 'ğŸ‰ ë‹¹ì‹ ' : 'ğŸ¤– AI') 
                        : (player === 1 ? 'âš« í‘ëŒ' : 'âšª ë°±ëŒ');
                    updateStatus(`${winner}ì˜ ìŠ¹ë¦¬ì…ë‹ˆë‹¤!`, true);
                    return;
                }
                
                if (board.every(row => row.every(cell => cell !== 0))) {
                    gameOver = true;
                    updateStatus('ğŸ¤ ë¬´ìŠ¹ë¶€ì…ë‹ˆë‹¤!', true);
                    return;
                }
                
                currentPlayer = (player === 1) ? 2 : 1;
                
                if (!gameOver) {
                    if (gameMode === 'ai' && currentPlayer === 2) {
                        triggerAITurn();
                    } else {
                        updateStatus(`${currentPlayer === 1 ? 'âš« í‘ëŒ' : 'âšª ë°±ëŒ'} ì°¨ë¡€ì…ë‹ˆë‹¤.`);
                    }
                }
            }

            function checkWin(x, y, player) {
                const dirs = [{dx: 1, dy: 0}, {dx: 0, dy: 1}, {dx: 1, dy: 1}, {dx: 1, dy: -1}];
                
                for (const {dx, dy} of dirs) {
                    let count = 1;
                    
                    for (let i = 1; i < 5; i++) {
                        if (board[y + i * dy]?.[x + i * dx] === player) count++;
                        else break;
                    }
                    
                    for (let i = 1; i < 5; i++) {
                        if (board[y - i * dy]?.[x - i * dx] === player) count++;
                        else break;
                    }
                    
                    if (count >= 5) return true;
                }
                return false;
            }

            function updateStatus(text, isFinal = false) {
                statusText.textContent = text;
                statusBox.className = 'status-box text-center p-4 rounded-xl shadow-lg mb-6';
                
                if (isFinal) {
                    statusBox.classList.add('bg-gradient-to-r', 'from-green-100', 'to-green-200', 'border-2', 'border-green-400');
                } else if (text.includes('AI')) {
                    statusBox.classList.add('bg-gradient-to-r', 'from-yellow-100', 'to-yellow-200');
                } else {
                    statusBox.classList.add('bg-white');
                }
            }

            function triggerAITurn() {
                isAIThinking = true;
                updateStatus('ğŸ¤” AIê°€ ìƒê° ì¤‘ì…ë‹ˆë‹¤...');
                setTimeout(() => {
                    const bestMove = findBestMove();
                    if (bestMove) placeStone(bestMove.x, bestMove.y, 2);
                    isAIThinking = false;
                }, 300);
            }

            // AI ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
            function findBestMove() {
                let bestScore = -Infinity, move = null;
                const possibleMoves = getPossibleMoves(board);
                
                for (const {x, y} of possibleMoves) {
                    board[y][x] = 2; 
                    if (checkWin(x, y, 2)) { 
                        board[y][x] = 0; 
                        return {x, y}; 
                    } 
                    board[y][x] = 0;
                    
                    board[y][x] = 1; 
                    if (checkWin(x, y, 1)) { 
                        board[y][x] = 0; 
                        return {x, y}; 
                    } 
                    board[y][x] = 0;
                }
                
                let depth = isCriticalSituation(board) ? CRITICAL_DEPTH : BASE_DEPTH;
                
                for (const {x, y} of possibleMoves) {
                    board[y][x] = 2;
                    const score = minimax(board, depth - 1, -Infinity, Infinity, false);
                    board[y][x] = 0;
                    if (score > bestScore) { 
                        bestScore = score; 
                        move = {x, y}; 
                    }
                }
                return move || possibleMoves[0];
            }

            function minimax(currentBoard, depth, alpha, beta, isMaximizing) {
                if (depth === 0) return evaluateBoard(currentBoard);
                const possibleMoves = getPossibleMoves(currentBoard);
                if (possibleMoves.length === 0) return evaluateBoard(currentBoard);

                if (isMaximizing) {
                    let maxEval = -Infinity;
                    for (const {x, y} of possibleMoves) {
                        currentBoard[y][x] = 2;
                        if (checkWin(x, y, 2)) { 
                            currentBoard[y][x] = 0; 
                            return 100000 + depth; 
                        }
                        maxEval = Math.max(maxEval, minimax(currentBoard, depth - 1, alpha, beta, false));
                        currentBoard[y][x] = 0;
                        alpha = Math.max(alpha, maxEval);
                        if (beta <= alpha) break;
                    }
                    return maxEval;
                } else {
                    let minEval = Infinity;
                    for (const {x, y} of possibleMoves) {
                        currentBoard[y][x] = 1;
                        if (checkWin(x, y, 1)) { 
                            currentBoard[y][x] = 0; 
                            return -100000 - depth; 
                        }
                        minEval = Math.min(minEval, minimax(currentBoard, depth - 1, alpha, beta, true));
                        currentBoard[y][x] = 0;
                        beta = Math.min(beta, minEval);
                        if (beta <= alpha) break;
                    }
                    return minEval;
                }
            }
            
            function getPossibleMoves(currentBoard) {
                const moves = new Set();
                if (currentBoard.every(row => row.every(cell => cell === 0))) return [{x: 7, y: 7}];
                
                for (let y = 0; y < BOARD_SIZE; y++) {
                    for (let x = 0; x < BOARD_SIZE; x++) {
                        if (currentBoard[y][x] === 0) {
                            for (let dy = -1; dy <= 1; dy++) {
                                for (let dx = -1; dx <= 1; dx++) {
                                    if (dx === 0 && dy === 0) continue;
                                    if (currentBoard[y + dy]?.[x + dx] > 0) {
                                        moves.add(JSON.stringify({x, y}));
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
                return Array.from(moves).map(m => JSON.parse(m));
            }

            function isCriticalSituation(currentBoard) {
                for (let y = 0; y < BOARD_SIZE; y++) {
                    for (let x = 0; x < BOARD_SIZE; x++) {
                        if (currentBoard[y][x] === 0) {
                            currentBoard[y][x] = 2; 
                            if (checkWin(x, y, 2)) { 
                                currentBoard[y][x] = 0; 
                                return true; 
                            }
                            currentBoard[y][x] = 1; 
                            if (checkWin(x, y, 1)) { 
                                currentBoard[y][x] = 0; 
                                return true; 
                            }
                            currentBoard[y][x] = 0;
                        }
                    }
                }
                return false;
            }

            function evaluateBoard(currentBoard) {
                let score = 0;
                const lines = [];
                
                for (let i = 0; i < BOARD_SIZE; i++) {
                    lines.push(currentBoard[i]);
                    lines.push(currentBoard.map(row => row[i]));
                }
                
                for (let i = 0; i < 2 * BOARD_SIZE - 1; i++) {
                    const diag1 = [], diag2 = [];
                    for (let j = 0; j < BOARD_SIZE; j++) {
                        if (i - j >= 0 && i - j < BOARD_SIZE) diag1.push(currentBoard[j][i - j]);
                        if (i - (BOARD_SIZE - 1 - j) >= 0 && i - (BOARD_SIZE - 1 - j) < BOARD_SIZE) diag2.push(currentBoard[j][i - (BOARD_SIZE - 1 - j)]);
                    }
                    if (diag1.length >= 5) lines.push(diag1);
                    if (diag2.length >= 5) lines.push(diag2);
                }
                
                lines.forEach(line => score += evaluateLine(line));
                return score;
            }

            function evaluateLine(line) {
                let score = 0;
                const patterns = {
                    '22222': 100000, '022220': 50000, '122220': 400, '022221': 400, '02220': 2000, 
                    '022020': 1800, '12220': 100, '02221': 100, '00220': 50, '02020': 50,
                    '11111': -100000, '011110': -80000, '211110': -10000, '011112': -10000, '01110': -5000, 
                    '011010': -4500, '21110': -500, '01112': -500, '00110': -150, '01010': -150,
                };
                const lineStr = line.join('');
                for (const p in patterns) { 
                    if (lineStr.includes(p)) score += patterns[p]; 
                }
                return score;
            }

            function init() {
                window.addEventListener('resize', resizeCanvas);
                canvas.addEventListener('click', handleCanvasClick);
                newGameBtn.addEventListener('click', initGame);
                gameBackToMenuBtn.addEventListener('click', backToGameMenu);
                aiModeBtn.addEventListener('click', () => startGame('ai'));
                pvpModeBtn.addEventListener('click', () => startGame('pvp'));
            }
            
            return { init, resizeCanvas };
        })();
        
        // --- ì•± ì´ˆê¸°í™” ---
        document.addEventListener('DOMContentLoaded', () => {
            pensionApp.init();
            gameApp.init();
        });
    </script>
</body>
</html>
